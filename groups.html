<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Bloc-Note</title>
    <meta charset="utf-8">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!--Let browser know website is optimized for mobile-->
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  </head>

  <body class="grey lighten-4">
    <!-- MENU -->
    <header>
        <nav class="white top-nav">
            <div class="container">
                <div class="nav-wrapper">
                <div class="row">
                    <div class="col s12 m12 offset-m1">
                        <div class="input-field col m5 offset-m1 recherche">
                            <input id="recherche" type="text" placeholder="Recherche" onkeyup="search()" class="valide z-depth-3">
                        </div>
                        <div class="col m3">
                            <div class="flow-text black-text prenom center-align">Vasyuk Mikhail</div>
                        </div>
                        <div class="col m1">
                           <a id="disconnection" class="waves-effect waves-light btn blue z-depth-2">Déconnexion</a>
                       </div>
                        <div class="col m1">
                            <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons black-text center-align">menu</i></a>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </nav>
    <ul id="slide-out" class="sidenav sidenav-fixed">
    <li class="noHover">
        <div class="user-view menu-img">
            <div class="background">
                <img id="logo" class="logo-menu" src="img/logo.png">
            </div>
        </div>
    </li>
    <hr>
    <li class="liMenu"><a href="notes.html"><i class="material-icons">event_note</i>Note</a></li>
    <li class="activeMenu liMenu"><a href="#!"><i class="material-icons">group</i>Groupe</a></li>
    </ul>
    </header>
    <!-- End Menu -->
    <div class="container">
      <div class="row" style="margin-top:20px;">
          <div class="col m4 offset-m2" style="margin-top:15px;">
              <a id="ajoutez" href="#modal1" class="waves-effect waves-light btn blue z-depth-2 modal-trigger"><i class="material-icons left">add</i>Ajoutez un groupe</a>
          </div>
      </div>
      <div class="row" id="groups" style="margin-left:150px">

      </div>
      <div id="modal1" class="modal">
          <div class="modal-content">
              <div class="row">
              <h4 class="center-align">Nouvelle group
                  <i id="closeNewNote" class="material-icons black-text center-align right pointer">close</i>
              </h4>
              </div>
              <form>
                  <div class="row">
                      <div class="input-field col s6 m6">
                          <input id="title" type="text" class="validate">
                          <label for="title">Titre</label>
                      </div>
                  </div>
                  <div class="row">
                      <div class="input-field col s11 m11">
                          <textarea id="message" class="materialize-textarea" onkeydown="characteresCount(100)"></textarea>
                          <label for="message">Descréption...</label>
                      </div>
                  </div>
              </form>
          </div>
          <div class="modal-footer row">
              <div id="over" class="col m1"></div>
      <div class="restriction col m11">
        <div class="circle">
          <svg height="20" width="20">
            <circle id="circle1" class="RadialCounter-progressUnderlay" cx="50%" cy="50%" r="8" fill="none" stroke-width="1"></circle>
            <circle id="circle2" class="js-progress-circle RadialCounter--safe" cx="50%" cy="50%" r="8" fill="none" stroke-width="2" style="stroke-dashoffset: 50;stroke-dasharray: 50.2655;"></circle>
          </svg>
        </div>
        <div id="errorCharacteres" class="left" style="display:none;margin-left:15px;">La lecture audio ne sera pas possible.</div>
                <a id="save_group" class="modal-close waves-effect waves-blue blue btn"><i class="material-icons right">check</i>Enregistrer</a>
        </div>
    </div>
      <!-- End modal add note -->


      </div>
    </div>


    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="text/javascript" src="js/mainWindow.js"></script>
    <script type="text/javascript">

      document.addEventListener('DOMContentLoaded', function() {
          var elems = document.querySelectorAll('select');
          var instances = M.FormSelect.init(elems);
          var elems2 = document.querySelectorAll('.sidenav');
          var instances2 = M.Sidenav.init(elems2);
          var elems3 = document.getElementById('modal1');
          var instances3 = M.Modal.init(elems3);
          document.getElementById('closeNewNote').onclick = function() {
              M.Modal.getInstance(elems3).close();
          }
        });

        $(document).ready(function(){
          ipc.send('verif_session');
          show_groups()
        })

        $('#disconnection').click(function(){
          ipc.send('destroy_session');
          ipc.send('verif_session');
        })

        function show_groups(){
      		$.ajax({
      			url: 'http://51.68.85.139:3000/group/show',
      			data: 'user_id='+ipc.sendSync('get_id'),
      			type: 'get',
      			success: function(data) {
      				for(i = 0; i < data.length; i++){
                groupe='<div draggable="true" ondrag="dragstart(event,noteId);" class="col s12 m4 "><div class="card white z-depth-3"><div class="card-content black-text"><span class="right iconNote" onclick="deleteNote(noteId, false);"><i class="material-icons black-text center-align">close</i></span><span class="right iconNote" onclick="modif(noteId);"><i class="material-icons black-text center-align">border_color</i></span><span class="right iconNote" onclick="speak(title, message, id)"><i class="material-icons black-text center-align">volume_up</i></span><span class="card-title titre">'+data[i]['title']+'</span><p>'+data[i]['description']+'</p></div><div class="card-action"><small>De : Vasyuk Mikhail</small><small class="right">Le : 20/06/2019</small></div></div></div></div>'
                $('#groups').append(groupe)
      				}
      			}
      		});
      	}

      	$('#save_group').click(function(){
      		ipc.send('verif_session');
      		$.ajax({
      			url: 'http://51.68.85.139:3000/group/create',
      			data: 'user_id='+ipc.sendSync('get_id')+'&title='+ $('#title').val() +'&description='+ $('#message').val(),
      			type: 'post',
      			success: function(data) {
      				 $('#groups').html('')
      				 show_groups()
      				 dialog_create.close();
      				// ipc.send('show_notes');
      				// ipc.send('verif_session');
      			}
      		});
      	})
    </script>
    </body>
